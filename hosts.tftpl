[all:vars]
ansible_user=ubuntu
ansible_ssh_private_key_file=~/.ssh/id_rsa
# This is where the bastion_ip variable from Terraform is used
ansible_ssh_common_args='-o ProxyJump=ubuntu@${bastion_ip}'

[webservers]
%{ for vm in web_nodes ~}
${vm.name} ansible_host=${vm.fqdn}
%{ endfor ~}

[monitoring]
%{ for name, vm in monitor_nodes ~}
${name} ansible_host=${vm.fqdn}
%{ endfor ~}

[elastic]
elasticsearch ansible_host=${elastic_fqdn}